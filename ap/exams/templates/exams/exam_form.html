{% extends "exams/base_exams.html" %}

{% load staticfiles %}
{% block title %}Create exam{% endblock %}

{% block scripts %}
<script type="text/javascript" src="{% static "exams/js/exam-create-save-post.js" %}"></script>
<script>

  function addSection(e){
    var section_div = $("#exam_section_blank").clone();
    section_div.removeAttr("id");
    section_div.removeClass("hidden");
    $("#sections").append(section_div);
  }

  function GetDynamicTextBox(value) {
    switch(value){
      case "E":
        return $('#essay-question-template').html();
        break;
      case "MC":
        return $('#mc-question-template').html();
        break;
      case "M":
        return $('#matching-question-template').html();
        break;
      case "TF":
        return $('#tf-question-template').html();
        break;
      case "FITB":
        return $('#fitb-question-template').html();
        break;
      default:
        return "";
    }
  }

  function selectOnlyThis(id) {
    for (var i = 0;i <= 1; i++) {
        document.getElementById("tf_" + i).checked = false;
    }
    document.getElementById(id).checked = true;
  }

  function addQuestion(e) {
    //How to find correct section_type; there are multiple with the same name?
    var type = $(e.target).parent().parent().find("[name='section_type']").val()
    console.log(e, type);
    $(e.target).parent().parent().find(".QuestionsContainer").append(GetDynamicTextBox(type));
  }

  function addCheckbox(e) {
    var checkbox = document.createElement('input');
    checkbox.type = "checkbox";
    checkbox.name = "name";
    checkbox.value = "value";
    checkbox.id = "id";

    var label = document.createElement('label')
    label.htmlFor = "id";
    label.appendChild(document.createTextNode('text for label after checkbox'));

    container.appendChild(checkbox);
    container.appendChild(label);
  }

  $(document).ready(function (e) {
    // Delete Question button
    $("body").on("click", ".remove.section", function () {
      $(this).closest("div.section").remove();
    }).on("click", ".remove.question", function () {
      $(this).closest("div.question").remove();
    }).on("click", "#btnAddSection", function(e) {
      addSection(e);
    }).on("click", "#btnAddQuestion", function(e) {
      addQuestion(e);
    });
  });

</script>

{% endblock scripts %}


{% block content %}
<form action="" id="surveyForm" method="post" class="form-horizontal">
  <fieldset>
    {% csrf_token %}

    <h3>{% if exam_not_available %}Create Exam{% else %}Edit Exam: {{ training_class }}{% endif %} </h3>
    <hr>

    {% if exam_not_available %}
    <div class="form-group" name="exam_metadata">
      <label class="col-md-2 control-label" for="selectclass">Class</label>
      <div class="col-md-4">
        <select id="selectclass" name="training-class" class="form-control">
          {% for class in classes %}
          <option value="{{ class.id }}">{{ class }}</option>
          {% empty %}
          <i>No classes to display.</i>
          {% endfor %}
        </select>
      </div>
    </div>
    {% else %}
    <input id="selectclass" type="text" hidden="true" name="training-class" value="{{training_class.id}}" />
    {% endif %}

    <div class="form-horizontal">

      <div class="form-group" name="exam_metadata">
        <label class="col-md-2 control-label" for="selectterm">Term</label>
        <div class="col-md-4">
          <select id="selectterm" name="term" class="form-control">
            {% if exam_not_available %}
              {% for term in terms %}
                <option value="{{ term.id }}">{{ term }}</option>
                {% empty %}
                <i>No terms to display.</i>
              {% endfor %}
            {% else %}
              <option value="{{ term.id }}">{{ term }}</option>
            {% endif %}
          </select>
        </div>
      </div>

      <div class="form-group" name="exam_metadata">
        <label class="col-md-2 control-label" for="textinput">Description</label>
        <div class="col-md-4">
          <input id="textinput" name="exam_description" type="text" placeholder="" class="form-control input-md" required="" value="{{ exam_description }}">
        </div>
      </div>

      <!-- Is the exam open -->
      <div class="form-group" name="exam_metadata">
        <label class="col-md-2 control-label" for="radios">Is Open</label>
        <div class="col-md-4">
          <div class="btn-group" data-toggle="buttons">
            <label class="btn btn-default {% if not exam_not_available and is_open %}active{% endif %}">
              <input type="radio" autocomplete="off" name="is-open" id="radios-0" value="True" {% if not exam_not_available and is_open %}checked{% endif %}> Yes
            </label>
            <label class="btn btn-default {% if not exam_not_available and not is_open %}active{% endif %}">
              <input type="radio" autocomplete="off" name="is-open" id="radios-1" value="False" {% if not exam_not_available and not is_open %}checked{% endif %}> No
            </label>
          </div>
        </div>
      </div>

      <!-- Exam Category -->
      <div class="form-group" name="exam_metadata">
        <label class="col-md-2 control-label" for="radios">Category</label>
        <div class="col-md-4">
          <div class="btn-group" data-toggle="buttons">
            <label class="btn btn-default {% if not exam_not_available and not is_final %}active{% endif %}">
              <input type="radio" autocomplete="off" name="exam-category" id="radios-0" value="M" {% if not exam_not_available and not is_final %}checked{% endif %}> Midterm
            </label>
            <label class="btn btn-default {% if not exam_not_available and is_final %}active{% endif %}">
              <input type="radio" autocomplete="off" name="exam-category" id="radios-1" value="F" {% if not exam_not_available and is_final %}checked{% endif %}> Final
            </label>
          </div>
        </div>
      </div>

      <!-- Exam duration-->
      <div class="form-group" name="exam_metadata">
        <label class="col-md-2 control-label" for="">Duration</label>
        <div class="col-md-4">
          <div class="input-group">
            <input id="" name="duration" type="text" placeholder="" class="form-control input-md" required="" value="{{ duration }}">
            <div class="input-group-addon">Minutes</div>
          </div>

        </div>
      </div>
    </div>

    <!-- Empty div for creating sections -->
    <h3>
      Sections
      <div class="pull-right">
        <input id="btnAddSection" class="btn btn-primary" type="button" value="Add Section" />
      </div>
    </h3>
    <hr>
    <div id="sections">
    <!--fix: for section in data (from utils get_edit_context_data) include each as an exam_section-->
      {% for section in data %}
       {% include 'exams/exam_section.html' %}
      {% endfor %}
    </div>

<div data-original='true' id='exam_section_blank' class="section clearfix hidden">
    <button type='button' class='close remove section' aria-label='Close'><span aria-hidden='true'>&times;</span>
    </button>
    <div name='div_section' class='form-horizontal'>
        <div class='form-group'>
            <label class='col-md-2'>Section Type </label>
            <input type="hidden" value="-1" name="section_id">
            <select class='col-md-6' name='section_type'>
                <option value='MC'>Multiple Choice</option>
                <option value='E'>Essay</option>
                <option value='M'>Matching</option>
                <option value='TF'>True/False</option>
                <option value='FITB'>Fill in the Blank</option>
            </select>
        </div>
    </div>
    <div class='form-horizontal'>
        <div class='form-group'>
            <label class='col-md-2'>Instructions </label>
            <textarea class='col-md-10' name='section_instructions'></textarea>
        </div>
    </div>
    <div class='pull-left'>
        <input id='btnAddQuestion' class='btn btn-primary' type='button' value='Add Question' />
    </div>
    <div class='QuestionsContainer'>
    </div>
    <br>
    <hr>
</div>

<!-- Question form for essay -->
<div class="question-form-container">
<div class="hidden" id="essay-question-template">
  <div class="question well well-sm small-bottom clearfix ">
    <button type="button" class="close remove question" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
    <div class="form-horizontal" name="exam_question">
    <input type="hidden" value="-1" name="question_id">
        <div class="form-group right-push col-xs-12 col-sm-12 col-md-6 col-lg-4">
            <div class="input-group">
                <div class="input-group-addon">Points</div>
                <input type="text" name="question-point" class="question form-control" placeholder="1" required=""/>
            </div>
        </div>
        <!-- <div class="spacer" style="float:left; height:20px; width:30px;"></div> -->
        <div class="form-group col-xs-2 col-sm-2 col-md-2 col-lg-2">
            <input type=hidden name="question-type" class="question form-control" value="essay"/>
            <div>Essay</div>
        </div>
        <div class="form-group no-bottom col-xs-12 col-sm-12">
            <textarea name="question-prompt" class="question form-control" placeholder="Enter question prompt"></textarea>
        </div>
    </div>
  </div>
</div>
</div>

<!-- Question form for mc -->
<div class="question-form-container">
<div class="hidden" id="mc-question-template">
  <div class="question well well-sm small-bottom clearfix ">
    <button type="button" class="close remove question" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
    <div class="form-horizontal" name="exam_question">
    <input type="hidden" value="-1" name="question_id">
        <div class="form-group right-push col-xs-12 col-sm-12 col-md-6 col-lg-4">
            <div class="input-group">
                <div class="input-group-addon">Points</div>
                <input type="text" name="question-point" class="question form-control" placeholder="1" required=""/>
            </div>
        </div>
        <div class="form-group col-xs-2 col-sm-2 col-md-2 col-lg-2">
             <input type=hidden name="question-type" class="question form-control" value="mc"/>
            <div>Multiple Choice</div>
        </div>
        <!-- <div class="spacer" style="float:left; height:20px; width:30px;"></div> -->
        <div class="form-group no-bottom col-xs-12 col-sm-12">
            <textarea name="question-prompt" class="question form-control" placeholder="Enter question prompt"></textarea>
        </div>
        <div class="form-group right-push col-xs-6 col-sm-6 col-md-6 col-lg-6" id="MCCheckboxes">
            <li><input type="checkbox" name="A" value=""> <textarea name="question-option-a" class="question form-control" placeholder="Enter choice A"></textarea></li>
             <li><input type="checkbox" name="B" value=""> <textarea name="question-option-b" class="question form-control" placeholder="Enter choice B"></textarea></li>
             <li><input type="checkbox" name="C" value=""> <textarea name="question-option-c" class="question form-control" placeholder="Enter choice C"></textarea></li>
             <li><input type="checkbox" name="D" value=""> <textarea name="question-option-d" class="question form-control" placeholder="Enter choice D"></textarea></li>
             <li><input type="checkbox" name="E" value=""> <textarea name="question-option-e" class="question form-control" placeholder="Enter choice E"></textarea></li>
             <button type="button" class="add_checkbox">Add Choice</button>
        </div>
        
    </div>
  </div>
</div>

<!-- Question form for matching -->
<div class="question-form-container">
<div class="hidden" id="matching-question-template">
  <div class="question well well-sm small-bottom clearfix ">
    <button type="button" class="close remove question" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
    <div class="form-horizontal" name="exam_question">
    <input type="hidden" value="-1" name="question_id">
        <div class="form-group right-push col-xs-12 col-sm-12 col-md-6 col-lg-4">
            <div class="input-group">
                <div class="input-group-addon">Points</div>
                <input type="text" name="question-point" class="question form-control" placeholder="1" required=""/>
            </div>
        </div>
        <div class="form-group col-xs-2 col-sm-2 col-md-2 col-lg-2">
            <input type=hidden name="question-type" class="question form-control" value="matching"/>
            <div>Matching</div>
        </div>
        <!-- <div class="spacer" style="float:left; height:20px; width:30px;"></div> -->
        <div class="form-group no-bottom col-xs-2 col-sm-2 left-push" style="float:left">
            <textarea name="question-prompt" class="question form-control" placeholder="I am crucified with Christ"></textarea>
        </div>
        <div class="form-group no-bottom col-xs-2 col-sm-2 left-push" style="float:left">
            <textarea name="question-match" class="question form-control" placeholder="Gal 2:20"></textarea>
        </div>
    </div>
  </div>
</div>
</div>

<!-- Question form for tf -->
<div class="question-form-container">
<div class="hidden" id="tf-question-template">
  <div class="question well well-sm small-bottom clearfix ">
    <button type="button" class="close remove question" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
    <div class="form-horizontal" name="exam_question">
    <input type="hidden" value="-1" name="question_id">
        <div class="form-group right-push col-xs-12 col-sm-12 col-md-6 col-lg-4">
            <div class="input-group">
                <div class="input-group-addon">Points</div>
                <input type="text" name="question-point" class="question form-control" placeholder="1" required=""/>
            </div>
        </div>
        <div class="form-group col-xs-2 col-sm-2 col-md-2 col-lg-2">
             <input type=hidden name="question-type" class="question form-control" value="tf"/>
            <div>True False</div>
        </div>
        <!-- <div class="spacer" style="float:left; height:20px; width:30px;"></div> -->
        <div class="form-group no-bottom col-xs-12 col-sm-12">
            <textarea name="question-prompt" class="question form-control" placeholder="Enter true-false statement"></textarea>
        </div>
        <div class="form-group no-bottom col-xs-12 col-sm-12">
            <input type='radio' id='tf_0' name='true' onclick="selectOnlyThis(this.id)"> True <br>
            <input type='radio' id='tf_1' name='false' onclick="selectOnlyThis(this.id)"> False <br>
        </div>
    </div>
  </div>
</div>
</div>

<!-- Question form for Fill in the blank -->
<div class="question-form-container">
<div class="hidden" id="fitb-question-template">
  <div class="question well well-sm small-bottom clearfix ">
    <button type="button" class="close remove question" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
    <div class="form-horizontal" name="exam_question">
    <input type="hidden" value="-1" name="question_id">
        <div class="form-group right-push col-xs-12 col-sm-12 col-md-6 col-lg-4">
            <div class="input-group">
                <div class="input-group-addon">Points</div>
                <input type="text" name="question-point" class="question form-control" placeholder="1" required=""/>
            </div>
        </div>
        <!-- <div class="spacer" style="float:left; height:20px; width:30px;"></div> -->
        <input type="hidden" value="-1" name="question_id">
          <div class="form-group col-xs-2 col-sm-2 col-md-2 col-lg-2">
            <input type=hidden name="question-type" class="question form-control" value="fitb"/>
            <div>Fill in the Blank</div>
          </div>
          <div class="form-group right-push col-xs-12 col-sm-12 col-md-6 col-lg-4">
            <div class="input-group">
                <div class="input-group-addon">Points</div>
                <input type="text" name="question-point" class="question form-control" placeholder="1" required=""/>
            </div>
          </div>
        <!-- <div class="spacer" style="float:left; height:20px; width:30px;"></div> -->
        <div class="form-group no-bottom col-xs-12 col-sm-12">
            <textarea name="question-prompt" class="question form-control" placeholder="Enter question prompt"></textarea>
        </div>
      </div>
    </div>
  </div>
</div>


    <!-- Create Exam Button -->
    <div class="form-group" id="exam-submit">
      <div class="col-md-4">
        <button id="" name="" class="btn btn-success">
          {% if exam_not_available %}
            Create Exam
          {% else %}
            Save Exam
          {% endif %}
        </button>
      </div>
    </div>
  </fieldset>
</form>

{% endblock %}

