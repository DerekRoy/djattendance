{% extends "lifestudies/base_lifestudies.html" %}

{% load bootstrap3 %}
{% load staticfiles %}

{% block lifestudies_content %}

    <h1>Submit Summary</h1>

    <form action="" method="post">
        {% bootstrap_form form %}
        {% csrf_token %}
        <button type="submit" disabled="true" id="summary_submit" name="attendance_assign" class="btn btn-success">Submit</button>
    </form>

<script>
  var books = {},
      bookSelect = $('#id_book'),
      chapterSelect = $('#id_chapter'),
      // Save initial state
      initialBook = bookSelect.val(),
      initialChapter = chapterSelect.val();

  // Auto-change min/max of chapterSelect when book changes
  bookSelect.on('change', function(ev) {
    // Add min, max-limit from rest api    
    var newBook = $(ev.currentTarget).val();
    if (!(newBook in books)) {
      return;
    } 
    chapterSelect.attr('min', 1);
    chapterSelect.attr('max', books[newBook].chapterSelects);
    // Update to original values if select original book
    if (newBook == initialBook) {
      chapterSelect.val(initialChapter);
    } else {
      chapterSelect.val(1);
    }
  });

/*
  $.ajax('/api/books/?format=json').success(function(response, status) {
    console.log('books', response);
    // populate books with response
    for (i in response) {
      books[response[i].id + ''] = response[i];
    }

    // Add min, max-limit from rest api    
    chapterSelect.attr('min', chapterSelect.val());
    chapterSelect.attr('max', books[bookSelect.val()].chapterSelects);

  });
*/

  // Word counter
  // First append the word count span
  var minCount = document.getElementById('id_minWords').value;
  var content = $('#id_content');
  var wc_text = $(document.createElement('b')).html('Word Count: ');
  var wc_span = $(document.createElement('span')).html('0');
  wc_span.attr('id', 'count');

  content.after(wc_text)
  wc_text.after(wc_span);
  wc_span.after('<br />');

  Countable.live(content.get(0), function(counter){
      var span = document.getElementById('count');
      span.innerHTML = counter.words;
      $("#summary_submit").get(0).disabled = counter.words>=minCount?false:true;
  })
</script>


{% endblock %}

{% block scripts %}
    <script src="{% static 'js/Countable.js' %}"></script>
{% endblock %}