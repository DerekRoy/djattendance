{% extends "base.html" %}

{% block title %}Life Study{% endblock %}

{% block content %}

    {% if profile.trainee %}

        <h3> Life Study Summaries</h3>

        {% if lifestudies %}
            {% for lifestudy in lifestudies %}
                {% if lifestudy.trainee.account_id == profile.pk and lifestudy.isCompleted == False %}
                    <li> {{lifestudy.displayForTrainee}} 
                        {% if lifestudy.getNumSummaryDue > 0 %}
                        <a href="{% url 'summary-create' lifestudy.pk %}"> New </a>
                        {% endif %}
                    </li>
                    <ul>
                        {% for summary in lifestudy.summary_set.all %}
                            <li> 
                                {{summary}} 
                                {% if summary.approved == False %}
                                <a href="{% url 'summary-detail' summary.pk %}"> Edit </a>
                                {% endif %}
                            </li>
                        {% endfor %}
                    </ul>
                {% endif %}
            {% endfor %}
        {% endif %}


    {% elif profile.trainingassistant %}

        <h3> Life Study TA View </h3>

        <table>
            <tr>
                <th> </th>
                <th> Name </th>
                <th> Infraction </th>
                <th> Offense </th>
                <th> Quantity </th>
                <th> Still Due </th>
                <th> Due Date </th>  
            </tr>
            {% for lifestudy in lifestudies %}
            {% if lifestudy.isCompleted == False %}
            <tr>
                <td> 
                    <form action="" method="post">
                    {% csrf_token %}
                        <input type="checkbox" name="selection" value="{{lifestudy.pk}}"></input>
                </td>
                <td>{{lifestudy.trainee.account.get_full_name}}</td>
                <td>{{lifestudy.infraction}}</td>
                <td>{{lifestudy.offense}}</td>
                <td>{{lifestudy.quantity}}</td>
                <td>{{lifestudy.getNumSummaryDue}}</td>
                <td>{{lifestudy.due | date:"m/d/y"}}</td>

                {% for summary in lifestudy.summary_set.all %}
                {{summary.approved}}
                <td>
                    <a href="{% url 'summary-approve' summary.pk %}"> 
                        {{summary.date_submitted | date:"m/d/y"}}
                    </a>
                </td>
                {% endfor %}
            </tr>
            {% endif %}
            {% endfor %}
        </table>
                        <input type="submit" value="approve selected"/>
                    </form>


        <!--assign LS to single trainee botton-->
        <form action="{% url 'lifestudy-create' %}">
            <input type="submit" value="Assign life-study to single trainee">
        </form>

        <!--assign LS to house button-->
        <form action="{% url 'lifestudy-house' %}">
            <input type="submit" value="Assign life-study to house">
        </form>

        <!--link to report view-->
        <a href="{% url 'reportview' %}"> Life Study Report</a>
    {% endif %}

{% endblock %}
