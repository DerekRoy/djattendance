{% extends "base.html" %}

{% block references %}
<style>
#week-select-container, #request-link {
  margin-top: 30px;
  margin-bottom: 15px;
}

/* List item styles */
.audio-item {
  cursor: pointer;
}

.audio-item .panel-heading-date {
  color: #939598;
}

.download-pending {
  color: #E6E8E1;
}
.download-denied {
  color: #F69D74;
}

.panel-body {
  display: none;
}
</style>
{% endblock %}

{% block scripts %}
<script>
class AudioList {
  constructor() {
    this.audioItems = $('.audio-item');
  }
}

$(document).ready(() => {
  $('#week-select')
  .select2({
    data: {{ view.weeks|safe }},
    minimumResultsForSearch: -1,
  })
  .val({{ view.week }})
  .trigger('change')
  .on('change', (e) => {
    window.location = "{% url 'audio:audio-home-week' week=999 %}".replace('999', e.target.value);
  });

  // List item scripts
  let player = new AudioPlayer();
  let audioList = new AudioList();
  audioList.audioItems.on('click', (e) => {
    let panel = e.currentTarget;
    player.playAudio(panel.getAttribute('src'));
    audioList.audioItems.removeClass('panel-primary');
    $(panel).removeClass('panel-default');
    $(panel).addClass('panel-primary');
  });
  audioList.audioItems[0].click();

  $('.download-button').click((e) => {
    $(e.target).parent().parent().parent().parent().find('.panel-body').toggle();
    return false;
  });
});
</script>
{% endblock %}

{% block content %}
{% include "audio/audio_player.html" %}

<div class="row">
  <div class="col-md-3">
    <h2 id="page-title">Audio Recording List</h2>
  </div>
  <div id="week-select-container" class="col-md-3">
    <select id="week-select"></select>
  </div>
  <div id="request-link" class="col-md-3">
    <a href="{% url 'audio:audio-request' %}">Request to download audio files</a>
  </div>
</div>

<div id="recording-list" class="row">
  {% for audiofile in object_list %}
    {% include 'audio/audiofile_detail.html' %}
  {% empty %}
    <div class="col-xs-12"><i>No audio recordings available for this week.</i></div>
  {% endfor %}
</div>
{% endblock %}
