{% extends "base.html" %}
{% load staticfiles %}

{% block title %}Switch User{% endblock %}

{% block scripts %}
  <script>
    var users = {{ users_bb|safe }};
    var userNames = {};
    var userList = [];
    for (var i = 0; i < users.length; i++) {
      userList.push({
        value: users[i].firstname + ' ' + users[i].lastname,
        id: users[i].id
      });
    }

    $(document).ready(function(e) {
      $("#userName").autocomplete({
        lookup: userList,
        autoSelectFirst: true,
        onSelect: function(suggestion) {
          let oldVal = $('#userId').val();
          $('#userId').val(suggestion.id);
          if (oldVal != suggestion.id) {
            $('form').submit();
          }
        }
      });
    })

  </script>

{% endblock %}

{% block content %}
<h2>Switch Identities</h2>

<div class="form-inline">
  <form id="submit-switch-user-form" method="post">
    {% csrf_token %}
    <label for="userName">User</label>=
    <input type="text" class="form-control" autofocus id="userName" maxlength="100"/>
    <input type="hidden" name="id" id="userId">
    <button type="submit" class="btn btn-default">Submit</button>
  </form>
</div>
{% endblock %}
